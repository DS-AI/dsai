#!/bin/bash

cp ../04-cloudera-manager-api/*.jar assets/install-parcels/lib/

cp ../03-anaconda-dsai-parcel-1.0/Anaconda*el7.parcel assets/parcels/

cd assets/parcels/

curl -LO http://archive.cloudera.com/cdh5/parcels/5.15.1/CDH-5.15.1-1.cdh5.15.1.p0.4-el7.parcel
curl -LO http://archive.cloudera.com/spark2/parcels/2.3.0.cloudera3/SPARK2-2.3.0.cloudera3-1.cdh5.13.3.p0.458809-el7.parcel

cd -

cd assets/rpms

curl -LO -H "Cookie: oraclelicense=accept-securebackup-cookie" http://download.oracle.com/otn-pub/java/jdk/8u201-b09/42970487e3af4f5aa5bca3f542482c60/jdk-8u201-linux-x64.rpm

for R in acl-2.2.51-14.el7.x86_64.rpm apr-1.4.8-3.el7_4.1.x86_64.rpm apr-util-1.5.2-6.0.1.el7.x86_64.rpm at-3.1.13-24.el7.x86_64.rpm autogen-libopts-5.18-5.el7.x86_64.rpm avahi-libs-0.6.31-19.el7.x86_64.rpm bc-1.06.95-13.el7.x86_64.rpm bind-libs-9.9.4-72.el7.x86_64.rpm bind-license-9.9.4-72.el7.noarch.rpm bind-utils-9.9.4-72.el7.x86_64.rpm binutils-2.27-34.base.0.1.el7.x86_64.rpm boost-1.53.0-27.el7.x86_64.rpm boost-atomic-1.53.0-27.el7.x86_64.rpm boost-chrono-1.53.0-27.el7.x86_64.rpm boost-context-1.53.0-27.el7.x86_64.rpm boost-date-time-1.53.0-27.el7.x86_64.rpm boost-filesystem-1.53.0-27.el7.x86_64.rpm boost-graph-1.53.0-27.el7.x86_64.rpm boost-iostreams-1.53.0-27.el7.x86_64.rpm boost-locale-1.53.0-27.el7.x86_64.rpm boost-math-1.53.0-27.el7.x86_64.rpm boost-program-options-1.53.0-27.el7.x86_64.rpm boost-python-1.53.0-27.el7.x86_64.rpm boost-random-1.53.0-27.el7.x86_64.rpm boost-regex-1.53.0-27.el7.x86_64.rpm boost-serialization-1.53.0-27.el7.x86_64.rpm boost-signals-1.53.0-27.el7.x86_64.rpm boost-system-1.53.0-27.el7.x86_64.rpm boost-test-1.53.0-27.el7.x86_64.rpm boost-thread-1.53.0-27.el7.x86_64.rpm boost-timer-1.53.0-27.el7.x86_64.rpm boost-wave-1.53.0-27.el7.x86_64.rpm bzip2-1.0.6-13.el7.x86_64.rpm cracklib-2.9.0-11.el7.x86_64.rpm cracklib-dicts-2.9.0-11.el7.x86_64.rpm createrepo-0.9.9-28.el7.noarch.rpm cronie-1.4.11-20.el7_6.x86_64.rpm cronie-anacron-1.4.11-20.el7_6.x86_64.rpm crontabs-1.11-6.20121102git.el7.noarch.rpm cryptsetup-libs-2.0.3-3.el7.x86_64.rpm cups-client-1.6.3-35.el7.x86_64.rpm cups-libs-1.6.3-35.el7.x86_64.rpm cyrus-sasl-gssapi-2.1.26-23.el7.x86_64.rpm cyrus-sasl-plain-2.1.26-23.el7.x86_64.rpm dbus-1.10.24-12.0.1.el7.x86_64.rpm dbus-libs-1.10.24-12.0.1.el7.x86_64.rpm deltarpm-3.6-3.el7.x86_64.rpm device-mapper-1.02.149-10.el7_6.2.x86_64.rpm device-mapper-libs-1.02.149-10.el7_6.2.x86_64.rpm dracut-033-554.0.3.el7.x86_64.rpm ed-1.9-4.el7.x86_64.rpm elfutils-default-yama-scope-0.172-2.el7.noarch.rpm elfutils-libs-0.172-2.el7.x86_64.rpm file-5.11-35.el7.x86_64.rpm fuse-2.9.4-1.0.4.el7.x86_64.rpm fuse-libs-2.9.4-1.0.4.el7.x86_64.rpm GeoIP-1.5.0-13.el7.x86_64.rpm gettext-0.19.8.1-2.el7.x86_64.rpm gettext-libs-0.19.8.1-2.el7.x86_64.rpm groff-base-1.22.2-8.el7.x86_64.rpm gzip-1.5-10.el7.x86_64.rpm hardlink-1.0-19.el7.x86_64.rpm hostname-3.13-3.el7.x86_64.rpm httpd-2.4.6-88.0.1.el7.x86_64.rpm httpd-tools-2.4.6-88.0.1.el7.x86_64.rpm initscripts-9.49.46-1.0.1.el7.x86_64.rpm iproute-4.11.0-14.el7.x86_64.rpm iptables-1.4.21-28.el7.x86_64.rpm iputils-20160308-10.el7.x86_64.rpm json-c-0.11-4.el7_0.x86_64.rpm keyutils-libs-devel-1.5.8-3.el7.x86_64.rpm kmod-20-23.0.1.el7.x86_64.rpm kmod-libs-20-23.0.1.el7.x86_64.rpm kpartx-0.4.9-123.el7.x86_64.rpm krb5-devel-1.15.1-34.el7.x86_64.rpm less-458-9.el7.x86_64.rpm libcom_err-devel-1.42.9-13.el7.x86_64.rpm libcroco-0.6.12-4.el7.x86_64.rpm libedit-3.0-12.20121213cvs.el7.x86_64.rpm libgomp-4.8.5-36.0.1.el7.x86_64.rpm libicu-50.1.2-17.el7.x86_64.rpm libkadm5-1.15.1-34.el7.x86_64.rpm libmnl-1.0.3-7.el7.x86_64.rpm libnetfilter_conntrack-1.0.6-1.el7_3.x86_64.rpm libnfnetlink-1.0.1-4.el7.x86_64.rpm libpipeline-1.2.3-3.el7.x86_64.rpm libpwquality-1.2.3-5.el7.x86_64.rpm libselinux-devel-2.5-14.1.el7.x86_64.rpm libsepol-devel-2.5-10.el7.x86_64.rpm libsmartcols-2.23.2-59.el7.x86_64.rpm libtirpc-0.2.4-0.15.el7.x86_64.rpm libtool-ltdl-2.4.2-22.el7_3.x86_64.rpm libunistring-0.9.3-9.el7.x86_64.rpm libuser-0.60-9.el7.x86_64.rpm libutempter-1.1.6-4.el7.x86_64.rpm libverto-devel-0.2.5-4.el7.x86_64.rpm libxslt-1.1.28-5.0.1.el7.x86_64.rpm lz4-1.7.5-2.0.1.el7.x86_64.rpm m4-1.4.16-10.el7.x86_64.rpm mailcap-2.1.41-2.el7.noarch.rpm mailx-12.5-19.el7.x86_64.rpm make-3.82-23.el7.x86_64.rpm man-db-2.6.3-11.el7.x86_64.rpm mariadb-libs-5.5.60-1.el7_5.x86_64.rpm mod_ssl-2.4.6-88.0.1.el7.x86_64.rpm MySQL-python-1.2.5-1.el7.x86_64.rpm ntp-4.2.6p5-28.0.1.el7.x86_64.rpm ntpdate-4.2.6p5-28.0.1.el7.x86_64.rpm numactl-libs-2.0.9-7.el7.x86_64.rpm openssl-1.0.2k-16.0.1.el7.x86_64.rpm openssl-devel-1.0.2k-16.0.1.el7.x86_64.rpm oracle-logos-70.0.3-4.0.9.el7.noarch.rpm pam-1.1.8-22.el7.x86_64.rpm passwd-0.79-4.el7.x86_64.rpm patch-2.7.1-10.el7_5.x86_64.rpm pbis-open-8.8.0-506.x86_64.rpm pbis-open-upgrade-8.8.0-506.x86_64.rpm pcre-devel-8.32-17.el7.x86_64.rpm perl-5.16.3-293.el7.x86_64.rpm perl-Carp-1.26-244.el7.noarch.rpm perl-constant-1.27-2.el7.noarch.rpm perl-Encode-2.51-7.el7.x86_64.rpm perl-Exporter-5.68-3.el7.noarch.rpm perl-File-Path-2.09-2.el7.noarch.rpm perl-File-Temp-0.23.01-3.el7.noarch.rpm perl-Filter-1.49-3.el7.x86_64.rpm perl-Getopt-Long-2.40-3.el7.noarch.rpm perl-HTTP-Tiny-0.033-3.el7.noarch.rpm perl-libs-5.16.3-293.el7.x86_64.rpm perl-macros-5.16.3-293.el7.x86_64.rpm perl-parent-0.225-244.el7.noarch.rpm perl-PathTools-3.40-5.el7.x86_64.rpm perl-Pod-Escapes-1.04-293.el7.noarch.rpm perl-Pod-Perldoc-3.20-4.el7.noarch.rpm perl-Pod-Simple-3.28-4.el7.noarch.rpm perl-Pod-Usage-1.63-3.el7.noarch.rpm perl-podlators-2.5.1-3.el7.noarch.rpm perl-Scalar-List-Utils-1.27-248.el7.x86_64.rpm perl-Socket-2.010-4.el7.x86_64.rpm perl-Storable-2.45-3.el7.x86_64.rpm perl-Text-ParseWords-3.29-4.el7.noarch.rpm perl-threads-1.87-4.el7.x86_64.rpm perl-threads-shared-1.43-6.el7.x86_64.rpm perl-Time-HiRes-1.9725-3.el7.x86_64.rpm perl-Time-Local-1.2300-2.el7.noarch.rpm pkgconfig-0.27.1-4.el7.x86_64.rpm postfix-2.10.1-7.el7.x86_64.rpm postgresql-9.2.24-1.el7_5.x86_64.rpm postgresql-libs-9.2.24-1.el7_5.x86_64.rpm postgresql-server-9.2.24-1.el7_5.x86_64.rpm procps-ng-3.3.10-23.el7.x86_64.rpm psmisc-22.20-15.el7.x86_64.rpm python-deltarpm-3.6-3.el7.x86_64.rpm python-psycopg2-2.5.1-3.el7.x86_64.rpm qrencode-libs-3.4.1-3.el7.x86_64.rpm redhat-lsb-core-4.1-27.0.1.el7.x86_64.rpm redhat-lsb-submod-security-4.1-27.0.1.el7.x86_64.rpm rpcbind-0.2.0-47.el7.x86_64.rpm spax-1.5.2-13.el7.x86_64.rpm systemd-219-62.0.3.el7.x86_64.rpm systemd-libs-219-62.0.3.el7.x86_64.rpm systemd-sysv-219-62.0.3.el7.x86_64.rpm sysvinit-tools-2.88-14.dsf.el7.x86_64.rpm tar-1.26-35.el7.x86_64.rpm tcp_wrappers-libs-7.6-77.el7.x86_64.rpm time-1.7-45.el7.x86_64.rpm unixODBC-2.3.1-11.el7.x86_64.rpm unzip-6.0-19.el7.x86_64.rpm util-linux-2.23.2-59.el7.x86_64.rpm which-2.20-7.el7.x86_64.rpm xz-5.2.2-1.el7.x86_64.rpm zlib-devel-1.2.7-18.el7.x86_64.rpm; do
    curl -LO https://yum.oracle.com/repo/OracleLinux/OL7/latest/x86_64/getPackage/$R;
done

curl -LO https://yum.oracle.com/repo/OracleLinux/OL7/developer_EPEL/x86_64/getPackage/jq-1.5-1.el7.x86_64.rpm
curl -LO https://yum.oracle.com/repo/OracleLinux/OL7/developer_EPEL/x86_64/getPackage/oniguruma-5.9.5-3.el7.x86_64.rpm
curl -LO https://yum.oracle.com/repo/OracleLinux/OL7/developer_EPEL/x86_64/getPackage/rhash-1.3.4-2.el7.x86_64.rpm

curl -LO https://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.15.1/RPMS/x86_64/cloudera-manager-agent-5.15.1-1.cm5151.p0.3.el7.x86_64.rpm
curl -LO https://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.15.1/RPMS/x86_64/cloudera-manager-daemons-5.15.1-1.cm5151.p0.3.el7.x86_64.rpm
curl -LO https://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.15.1/RPMS/x86_64/cloudera-manager-server-5.15.1-1.cm5151.p0.3.el7.x86_64.rpm
curl -LO https://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.15.1/RPMS/x86_64/cloudera-manager-server-db-2-5.15.1-1.cm5151.p0.3.el7.x86_64.rpm

curl -LO https://repo.pbis.beyondtrust.com/yum/pbiso/x86_64/Packages/pbis-open-8.8.0-506.x86_64.rpm
curl -LO https://repo.pbis.beyondtrust.com/yum/pbiso/x86_64/Packages/pbis-open-upgrade-8.8.0-506.x86_64.rpm

cd -

rpm2cpio ../01-spark-patched/spark-python-1.6.0+cdh5.15.1+570+2-1.cdh5.15.1.p0.4.el7.noarch.rpm | cpio -iv --to-stdout ./usr/lib/spark/python/pyspark/cloudpickle.py > assets/spark-patch/cloudpickle.py
rpm2cpio ../01-spark-patched/spark-python-1.6.0+cdh5.15.1+570+2-1.cdh5.15.1.p0.4.el7.noarch.rpm | cpio -iv --to-stdout ./usr/lib/spark/python/pyspark/serializers.py > assets/spark-patch/serializers.py
rpm2cpio ../01-spark-patched/spark-core-1.6.0+cdh5.15.1+570+2-1.cdh5.15.1.p0.4.el7.noarch.rpm | cpio -iv --to-stdout ./usr/lib/spark/lib/spark-assembly-1.6.0-cdh5.15.1-hadoop2.6.0-cdh5.15.1.jar > assets/spark-patch/spark-assembly-1.6.0-cdh5.15.1-hadoop2.6.0-cdh5.15.1.jar
